{
  "name": "Prototype Project Workflow",
  "version": "1.0",
  "description": "Structured workflow for creating consistent, defensible prototypes through coordinated AI agents",
  "strict": true,
  "phases": [
    {
      "name": "Phase 1: Project Foundation",
      "description": "One-time setup - establishes shared foundation for all prototypes",
      "runOnce": true,
      "steps": [
        {
          "id": "business-requirements",
          "name": "Business Requirements Gathering",
          "agent": "project-requirements.agent.md",
          "description": "Clarify customer needs, business intent, and project purpose",
          "inputs": {
            "required": [
              "Organization website URL"
            ],
            "optional": [
              "Project briefs",
              "Workshop notes",
              "Strategy documents"
            ]
          },
          "outputs": [
            "docs/project-docs/business-requirements.md"
          ],
          "userApprovalRequired": true,
          "blocking": true,
          "skills": [
            "requirements-thinking-with-validation"
          ]
        },
        {
          "id": "style-tokens",
          "name": "Design Token Extraction",
          "agent": "project-style-token.agent.md",
          "description": "Extract shared CSS design tokens for visual consistency",
          "requires": ["business-requirements"],
          "inputs": {
            "required": [
              "Customer website URL (from business-requirements)"
            ]
          },
          "outputs": [
            "prototypes/shared/styles/design-tokens.css"
          ],
          "optionalOutputs": [
            "docs/project-docs/design-tokens-notes.md"
          ],
          "userApprovalRequired": true,
          "blocking": true
        },
        {
          "id": "project-setup",
          "name": "Application Setup",
          "agent": "project-setup.agent.md",
          "description": "Initialize React application, create shared systems structure, and generate landing page",
          "requires": ["style-tokens"],
          "inputs": {
            "required": [
              "docs/project-docs/business-requirements.md",
              "prototypes/shared/styles/design-tokens.css"
            ]
          },
          "outputs": [
            "prototypes/package.json",
            "prototypes/src/App.jsx",
            "prototypes/shared/components/",
            "prototypes/shared/styles/",
            "prototypes/shared/assets/",
            "prototypes/shared/utils/"
          ],
          "actions": [
            "Initialize React application",
            "Create shared systems structure",
            "Set up core UI components (confirmation dialog, toast notifications)",
            "Generate landing page with empty state placeholder",
            "Run npm install",
            "Configure development environment"
          ],
          "userActions": [
            "Manually start dev server: npm run dev",
            "Verify application runs successfully"
          ],
          "blocking": true
        },
        {
          "id": "code-review-foundation",
          "name": "Code Review & Compliance Gate (Foundation)",
          "agent": "general-code-review.agent.md",
          "description": "Review scaffolding, shared components, and landing page for code quality and design token compliance",
          "requires": ["project-setup"],
          "inputs": {
            "required": [
              "prototypes/",
              "prototypes/shared/components/",
              "prototypes/shared/styles/design-tokens.css",
              "docs/framework-docs/requirements.md",
              "docs/framework-docs/css-guidelines.md"
            ],
            "context": [
              "docs/project-docs/business-requirements.md"
            ]
          },
          "reviewDimensions": [
            "Design Token Usage - verify all styling uses tokens from design-tokens.css",
            "Architectural Integrity - proper component structure and separation of concerns",
            "Code Quality - readability, maintainability of foundational code",
            "Rule Compliance - adherence to framework requirements and CSS guidelines"
          ],
          "workflow": [
            {
              "step": "Review Foundation Code",
              "activities": [
                "Review landing page implementation",
                "Review shared component structure",
                "Verify design token usage throughout",
                "Check architectural setup and patterns",
                "Evaluate code quality and maintainability"
              ],
              "note": "Phase 1: No prototypes exist yet - reviewing scaffolding only"
            },
            {
              "step": "Produce Verdict",
              "activities": [
                "Generate Summary Verdict (Acceptable/Conditionally Acceptable/Unacceptable)",
                "Create Rule-by-Rule Compliance Table",
                "Compile Problem List with IDs if verdict ≠ Acceptable",
                "Document Non-Blocking Issues (optional fixes)"
              ]
            },
            {
              "step": "Orchestrate Fixes (If Problems Found)",
              "activities": [
                "Freeze scope - no new improvements",
                "Invoke project-setup-agent with Problem List",
                "Provide explicit instruction: Fix only listed problems",
                "Define success criteria: Each problem ID resolved, no new violations"
              ],
              "conditional": "Only if Problem List items exist"
            },
            {
              "step": "Verify Fixes",
              "activities": [
                "Re-review corrected code",
                "Verify each problem ID resolved",
                "Ensure no new violations introduced",
                "Produce final verdict"
              ],
              "conditional": "After fixes applied"
            }
          ],
          "outputs": [
            "Code review report with verdict",
            "Problem List (if issues found)",
            "Rule-by-Rule Compliance Table"
          ],
          "fixOrchestration": {
            "agent": "project-setup.agent.md",
            "constraints": [
              "Fix strictly to spec",
              "Preserve existing behavior unless violating a rule",
              "No refactoring beyond scope",
              "No speculative improvements"
            ],
            "handoff": {
              "context": "This is a corrective pass for foundation code, not a redesign",
              "inputs": ["Foundation codebase", "Problem List with IDs"],
              "output": "Updated code with Problem ID → Fix mapping"
            }
          },
          "behavioralConstraints": [
            "Do NOT assume intent",
            "Do NOT soften findings",
            "Do NOT rewrite code directly",
            "Do NOT merge review and build roles",
            "Do NOT allow speculative fixes",
            "Surface ambiguity, do not resolve silently"
          ],
          "blocking": true,
          "gate": true,
          "notes": [
            "This is Phase 1 review - no prototypes exist yet",
            "Focus on foundational code quality and design token compliance",
            "Business requirements provide context only (not functional spec)"
          ]
        },
        {
          "id": "cleanup-phase-1",
          "name": "Structure Cleanup (Phase 1 Complete)",
          "agent": "general-folder-cleanup.agent.md",
          "description": "Enforce canonical structure after Phase 1 completion",
          "requires": ["code-review-foundation"],
          "inputs": {
            "required": [
              "docs/project-docs/business-requirements.md",
              "prototypes/shared/styles/design-tokens.css",
              "prototypes/package.json"
            ]
          },
          "workflow": [
            "Scan project structure",
            "Detect violations",
            "Propose corrective actions (if violations found)",
            "Execute changes after user approval",
            "Update references",
            "Verify and report completion"
          ],
          "userApprovalRequired": true,
          "blocking": false
        }
      ],
      "completionCriteria": [
        "Business requirements documented and approved",
        "Design tokens extracted and approved",
        "React application initialized",
        "Development environment verified working",
        "Landing page created and accessible",
        "Code review gate passed (verdict: Acceptable)",
        "All foundation code compliance violations resolved",
        "Project structure verified and compliant"
      ]
    },
    {
      "name": "Phase 2: Prototype Cycle",
      "description": "Repeat for each prototype - builds on shared foundation",
      "repeatable": true,
      "requiresPhase": "Phase 1: Project Foundation",
      "steps": [
        {
          "id": "prototype-requirements",
          "name": "Prototype Requirements Research",
          "agent": "prototype-requirements.agent.md",
          "description": "BA and UX research: discover and document requirements combining business and user perspectives (no design decisions)",
          "inputs": {
            "required": [
              "docs/framework-docs/requirements.md",
              "docs/framework-docs/css-guidelines.md"
            ],
            "optional": [
              "docs/project-docs/prototype-[prototype-name]/brief.md",
              "Wireframes",
              "Supporting materials"
            ],
            "context": [
              "docs/project-docs/business-requirements.md"
            ]
          },
          "workflow": [
            "Phase 0: Module Identification & User Guidance (if module not provided)",
            "Step 1: Brief & Materials Review",
            "Step 2: Complexity Check (stop if too complex)",
            "Step 3: Read Framework Requirements",
            "Step 4: Understand What to Capture (prototype-specific only)",
            "Step 5: Requirements Q&A via requirements-thinking-with-validation skill",
            "Step 6: Integrate Information Sources",
            "Step 7: Document Prototype Requirements",
            "Step 8: Requirements Quality Review via requirements-review skill",
            "Step 9: User Approval of Requirements"
          ],
          "outputs": [
            "docs/project-docs/prototype-[prototype-name]/prototype-requirements.md"
          ],
          "userApprovalRequired": true,
          "blocking": true,
          "skills": [
            "requirements-thinking-with-validation",
            "requirements-review"
          ],
          "mandatoryCaptures": [
            "Prototype Purpose - why it exists (business + user value)",
            "Users - primary and secondary user roles",
            "Core User Tasks - max 5 tasks with business and user value",
            "Must-Have Functionality - MVP scope with explicit out-of-scope items",
            "Business Constraints",
            "User Constraints",
            "Assumptions - business, user, and technical",
            "Success Criteria - business and user outcomes",
            "Risks - business, UX, and scope risks"
          ],
          "complexityGatekeeper": true,
          "notes": [
            "This agent performs combined BA and UX research",
            "No design decisions are made at this stage",
            "Output is combined business and user requirements",
            "Agent will stop user if module is too complex and suggest splits"
          ]
        },
        {
          "id": "prototype-design",
          "name": "Prototype Design Intent",
          "agent": "prototype-design.agent.md",
          "description": "Systems and Interface design: translate requirements into clear design intent with views, patterns, flows, and controls (produces 2 documents)",
          "requires": ["prototype-requirements"],
          "inputs": {
            "required": [
              "docs/project-docs/prototype-[prototype-name]/prototype-requirements.md",
              "docs/framework-docs/requirements.md",
              "docs/framework-docs/css-guidelines.md"
            ],
            "context": [
              "docs/project-docs/business-requirements.md",
              "prototypes/shared/styles/design-tokens.css"
            ]
          },
          "workflow": [
            "Step 1: Read and Validate Requirements",
            "Step 2: Read Framework Requirements",
            "Step 3: Clarify Prototype Purpose",
            "Step 4: Extract and Organize User Tasks",
            "Step 5: Suggest Prototype Views (numbered options)",
            "Step 6: Suggest UI Patterns (numbered options)",
            "Step 7: Ascertain Design Preferences",
            "Step 8: Suggest UI Architecture Alternatives (numbered options)",
            "Step 9: Define Task Flows for Each User Story",
            "Step 10: Identify Required Controls",
            "Step 11: Categorize Common vs Custom Controls",
            "Step 12: Define MVP Feature Set",
            "Step 13: Capture Additional Feature Ideas",
            "Step 14: Identify and Document Risks",
            "Step 15: Document Design Intent",
            "Step 16: Create User Verification Tasks",
            "Step 17: Review Design Documentation Quality via requirements-review skill",
            "Step 18: User Approval of Design Documents"
          ],
          "outputs": [
            "docs/project-docs/prototype-[prototype-name]/design-brief.md",
            "docs/project-docs/prototype-[prototype-name]/user-verification-tasks.md"
          ],
          "userApprovalRequired": true,
          "blocking": true,
          "skills": [
            "requirements-review"
          ],
          "notes": [
            "This agent performs combined systems and interface design",
            "Uses requirements from prototype-requirements agent",
            "Presents design alternatives using numbered options",
            "Does NOT re-research requirements or change scope",
            "User must approve both design documents before handoff to development"
          ]
        },
        {
          "id": "prototype-implementation",
          "name": "Prototype Implementation",
          "agent": "prototype-development.agent.md",
          "description": "Build the prototype based on all requirement documents",
          "requires": ["prototype-design"],
          "inputs": {
            "required": [
              "docs/project-docs/business-requirements.md",
              "prototypes/shared/styles/design-tokens.css",
              "docs/project-docs/prototype-[prototype-name]/prototype-requirements.md",
              "docs/project-docs/prototype-[prototype-name]/design-brief.md",
              "docs/framework-docs/requirements.md",
              "docs/framework-docs/css-guidelines.md"
            ]
          },
          "workflow": [
            {
              "step": "Read Requirements",
              "activities": [
                "Read all requirement documents",
                "Create implementation checklist",
                "Understand acceptance criteria"
              ]
            },
            {
              "step": "Review Shared Components",
              "activities": [
                "Review existing shared components for reuse",
                "Identify gaps requiring new components"
              ]
            },
            {
              "step": "Create Shared Components",
              "activities": [
                "Build new shared components in prototypes/shared/components/",
                "Follow CSS guidelines and design tokens",
                "Ensure reusability across prototypes"
              ]
            },
            {
              "step": "Build Prototype Structure",
              "activities": [
                "Create prototype folder structure",
                "Set up routing and navigation",
                "Implement prototype-specific logic"
              ]
            },
            {
              "step": "Implement UI Screens",
              "activities": [
                "Build screens using shared components",
                "Apply design tokens for styling",
                "Implement user interactions",
                "Add proper accessibility attributes"
              ]
            },
            {
              "step": "Assemble Prototype",
              "activities": [
                "Connect screens into complete workflow",
                "Ensure prototype is fully clickable",
                "Test all user paths"
              ]
            },
            {
              "step": "Update Landing Page",
              "activities": [
                "Add link to new prototype",
                "Include prototype name and description",
                "Ensure clear navigation"
              ],
              "critical": true
            },
            {
              "step": "Code Review",
              "activities": [
                "Run comprehensive code review checklist",
                "Verify all requirements met",
                "Check acceptance criteria"
              ]
            }
          ],
          "outputs": [
            "prototypes/[prototype-name]/",
            "prototypes/shared/components/ (updated as needed)",
            "prototypes/src/App.jsx (updated with prototype link)"
          ],
          "userActions": [
            "Start dev server (if not running): npm run dev",
            "Test prototype thoroughly",
            "Provide feedback or type 'approve'"
          ],
          "userApprovalRequired": true,
          "blocking": true
        },
        {
          "id": "code-review-compliance",
          "name": "Code Review & Compliance Gate",
          "agent": "general-code-review.agent.md",
          "description": "Strict code review against specifications and rules with automated fix orchestration",
          "requires": ["prototype-implementation"],
          "inputs": {
            "required": [
              "prototypes/[prototype-name]/",
              "prototypes/shared/components/",
              "docs/framework-docs/requirements.md",
              "docs/framework-docs/css-guidelines.md",
              "docs/project-docs/prototype-[prototype-name]/prototype-requirements.md",
              "docs/project-docs/prototype-[prototype-name]/design-brief.md"
            ]
          },
          "reviewDimensions": [
            "Specification Adherence - missing, incorrect, or extra behavior",
            "Rule Compliance - explicit evaluation of every rule",
            "Architectural Integrity - layer violations, coupling errors, responsibility leaks",
            "Code Quality - readability, duplication, hidden complexity",
            "Safety & Risk - error handling, edge cases, security issues",
            "Maintainability - change cost, clarity of intent, future extensibility"
          ],
          "workflow": [
            {
              "step": "Review Code Against Rules",
              "activities": [
                "Evaluate all review dimensions",
                "Check specification adherence",
                "Verify rule compliance with evidence",
                "Assess architectural integrity",
                "Review code quality",
                "Identify safety and risk issues",
                "Evaluate maintainability"
              ]
            },
            {
              "step": "Produce Verdict",
              "activities": [
                "Generate Summary Verdict (Acceptable/Conditionally Acceptable/Unacceptable)",
                "Create Rule-by-Rule Compliance Table",
                "Compile Problem List with IDs if verdict ≠ Acceptable",
                "Document Non-Blocking Issues (optional fixes)"
              ]
            },
            {
              "step": "Orchestrate Fixes (If Problems Found)",
              "activities": [
                "Freeze scope - no new improvements",
                "Invoke prototype-development-agent with Problem List",
                "Provide explicit instruction: Fix only listed problems",
                "Define success criteria: Each problem ID resolved, no new violations"
              ],
              "conditional": "Only if Problem List items exist"
            },
            {
              "step": "Verify Fixes",
              "activities": [
                "Re-review corrected code",
                "Verify each problem ID resolved",
                "Ensure no new violations introduced",
                "Produce final verdict"
              ],
              "conditional": "After fixes applied"
            }
          ],
          "outputs": [
            "Code review report with verdict",
            "Problem List (if issues found)",
            "Rule-by-Rule Compliance Table"
          ],
          "fixOrchestration": {
            "agent": "prototype-development.agent.md",
            "constraints": [
              "Fix strictly to spec",
              "Preserve existing behavior unless violating a rule",
              "No refactoring beyond scope",
              "No speculative improvements"
            ],
            "handoff": {
              "context": "This is a corrective pass, not a redesign",
              "inputs": ["Codebase", "Problem List with IDs"],
              "output": "Updated code with Problem ID → Fix mapping"
            }
          },
          "behavioralConstraints": [
            "Do NOT assume intent",
            "Do NOT soften findings",
            "Do NOT rewrite code directly",
            "Do NOT merge review and build roles",
            "Do NOT allow speculative fixes",
            "Surface ambiguity, do not resolve silently"
          ],
          "blocking": true,
          "gate": true
        },
        {
          "id": "validation-revision",
          "name": "Validation & Revision",
          "description": "Address issues found during user testing",
          "optional": true,
          "triggeredBy": "user feedback",
          "requires": ["code-review-compliance"],
          "workflow": [
            "User reports specific issues",
            "Agent fixes issues in tightly scoped changes",
            "Agent re-runs code review checklist",
            "User tests again",
            "Repeat until approved"
          ],
          "focus": "One round of feedback and fixes per prototype"
        },
        {
          "id": "cleanup-phase-2",
          "name": "Structure Cleanup (Prototype Cycle Complete)",
          "agent": "general-folder-cleanup.agent.md",
          "description": "Enforce canonical structure after prototype cycle completion",
          "requires": ["code-review-compliance"],
          "inputs": {
            "required": [
              "docs/project-docs/prototype-[prototype-name]/prototype-requirements.md",
              "docs/project-docs/prototype-[prototype-name]/design-brief.md",
              "docs/project-docs/prototype-[prototype-name]/user-verification-tasks.md",
              "prototypes/[prototype-name]/"
            ]
          },
          "workflow": [
            "Scan project structure",
            "Detect violations",
            "Propose corrective actions (if violations found)",
            "Execute changes after user approval",
            "Update references",
            "Verify and report completion"
          ],
          "userApprovalRequired": true,
          "blocking": false
        }
      ],
      "completionCriteria": [
        "Prototype requirements research complete (prototype-requirements.md approved)",
        "Prototype design intent complete (design-brief.md and user-verification-tasks.md approved)",
        "All 3 documents approved by user",
        "Prototype implemented and tested",
        "Code review gate passed (verdict: Acceptable)",
        "All compliance violations resolved",
        "Landing page updated with prototype link",
        "User has approved the prototype",
        "All acceptance criteria met",
        "Project structure verified and compliant"
      ],
      "notes": [
        "This cycle is independent for each prototype",
        "Shared components may be created/updated during implementation",
        "Foundation elements (tokens, business requirements) are reused, not recreated"
      ]
    }
  ],
  "managedSkills": [
    {
      "id": "requirements-thinking-with-validation",
      "name": "Requirements Thinking Partner (Validated & Traceable)",
      "purpose": "Help users express requirements naturally through informal conversation while ensuring formal, complete, traceable output",
      "usedBy": [
        "project-requirements-agent",
        "prototype-requirements-agent"
      ],
      "timing": "During requirements gathering phase (before creating requirement documents)",
      "output": "Formal Requirements Summary (5 sections: Overview, Confirmed Decisions, Constraints & Rules, Assumptions, Open Questions)",
      "invocation": "Agents use the Skill tool during their workflow",
      "approach": "Informal conversational Q&A with formal structured output"
    },
    {
      "id": "requirements-review",
      "name": "Requirements Review",
      "purpose": "Review requirements documents against established rules and framework guidance, report issues clearly and concisely",
      "usedBy": [
        "project-requirements-agent",
        "prototype-requirements-agent",
        "prototype-design-agent"
      ],
      "timing": "After creating requirement or design documents, before presenting to user for approval",
      "output": "Requirements Review Report",
      "invocation": "Agents use the Skill tool during their workflow"
    }
  ],
  "orchestrationRules": [
    "Strict Ordering: No agent may start before its dependencies are complete",
    "One Active Agent at a Time: Do not interleave agent conversations",
    "Skill Invocation: Skills are invoked by agents, not by the orchestrator directly",
    "Document Handoffs: Each agent's output is treated as immutable input for the next agent",
    "No Shortcuts: If a user attempts to skip an agent, stop and redirect",
    "Multiple Prototypes: Foundation work is reused, prototype cycles are isolated",
    "User Approvals: Requirement documents must be explicitly approved before proceeding",
    "Manual Server Start: Dev server must always be started manually by user, never automatically"
  ],
  "failureConditions": [
    "Foundation phase is incomplete",
    "An agent output is missing or unclear",
    "User attempts to collapse phases",
    "Required user approval not obtained"
  ]
}
